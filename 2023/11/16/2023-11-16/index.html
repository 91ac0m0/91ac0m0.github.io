<!DOCTYPE html>
<html>
<head>
    <title>giacomo&#39;s journal</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <link
    rel="stylesheet"
    href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css"
    />
    <script>hljs.highlightAll();</script>
    <script>hljs.addPlugin(new CopyButtonPlugin());</script>


    
<link rel="stylesheet" href="/css/style.css">

    
<script src="/js/jquery-3.7.1.min.js"></script>

    
<script src="/js/bootstrap-transition.js"></script>

    
<script src="/js/zoom.js"></script>


    <style>
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin-left: 28%;
            margin-top: 6%;

            padding: 45px;
        }

        @media (max-width: 767px) {
            .markdown-body {
                padding: 15px;
            }
        }
    </style>
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
    <header class="header">

    <div class="navbar-left">
        <div class="avatar">
            <a href="/">
                <img src="https://91ac0m0.github.io/img/avatar.jpg"alt="avatar">
            </a>
        </div>
        <div class="nav-title">
            <a class="nav-brand" href="/">giacomo</a>
        </div>
    </div>
    <div class="navbar-right">
        <ul class="nav-links">
            
                <div class="nav-link">
                    <a href="/about" class="menu-item-link">
                        about
                    </a>
                </div>
            
        </ul>

    </div>
    

</header>

    <div class = "toc_left">
	
    <div id="toc">
        <!-- <strong class="sidebar-title">目录</strong> -->
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#python-venv"><span class="toc-text">python venv</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E4%BF%9D%E6%8A%A4-config"><span class="toc-text">查看保护 config</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%AC%A6%E5%8F%B7%E8%A1%A8"><span class="toc-text">恢复符号表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kernel-%E8%B0%83%E8%AF%95"><span class="toc-text">kernel 调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%AD%E7%82%B9%E6%96%AD%E4%B8%8D%E4%B8%8B%E6%9D%A5"><span class="toc-text">断点断不下来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#water-ker"><span class="toc-text">water_ker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E5%8D%B0%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text">打印结构体</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E4%B8%A4%E4%B8%AA-extern-%E5%8F%98%E9%87%8F"><span class="toc-text">有两个 extern 变量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kmalloc-caches-NR-KMALLOC-TYPES-KMALLOC-SHIFT-HIGH-1"><span class="toc-text">kmalloc_caches [NR_KMALLOC_TYPES][KMALLOC_SHIFT_HIGH + 1];</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#slab-caches"><span class="toc-text">slab_caches</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#slab-cache-%E7%9A%84%E5%88%86%E7%B1%BB"><span class="toc-text">slab cache 的分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kmalloc-trace"><span class="toc-text">kmalloc_trace</span></a></li></ol>
    </div>

</div>
<article class="markdown-body">
	<div></div><h2 id="python-venv"><a href="#python-venv" class="headerlink" title="python venv"></a>python venv</h2><p>为了避免 python 包和 apt 安装的包冲突</p>
<p><a target="_blank" rel="noopener" href="https://www.omgubuntu.co.uk/2023/04/pip-install-error-externally-managed-environment-fix">3 Ways to Solve Pip Install Error on Ubuntu 23.04 - OMG! Ubuntu</a></p>
<ul>
<li>对于在 Ubuntu&#x2F;Debian repos 中的 package 可以使用 aot install python3-xyz</li>
<li>pipx 的适用场景比较单一，它只适用于安装和运行那些有提供命令行入口的 app。</li>
</ul>
<h2 id="查看保护-config"><a href="#查看保护-config" class="headerlink" title="查看保护 config"></a>查看保护 config</h2><p><a target="_blank" rel="noopener" href="https://rtfingc.github.io/slub-freelist-hardened">Slub Freelist Hardened</a></p>
<ul>
<li>去 &#x2F;porc&#x2F;config.gz 下面看</li>
<li>去 &#x2F;boot&#x2F;config 下面看</li>
</ul>
<p>需要开启内核配置项 CONFIG_IKCONFIG 才会生成这个文件。</p>
<pre><code>/proc/config.gz  
This file shows you the compile-time configuration settings for the kernel (gzip compressed, use zcat or zless to see its contents). It is available only if you enable it using CONFIG_IKCONFIG_PROC when you compile.

Say you want to upgrade to the next available kernel. Your current kernel works fine, so you&#39;d like to use the same parameters, but you accidentally lost your original .config configuration file. Simplyzcat /proc/config.gz &gt; /usr/src/linux/.config and you&#39;re ready to go.
</code></pre>
<h2 id="恢复符号表"><a href="#恢复符号表" class="headerlink" title="恢复符号表"></a>恢复符号表</h2><p><a target="_blank" rel="noopener" href="https://github.com/marin-m/vmlinux-to-elf">marin-m&#x2F;vmlinux-to-elf:</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux">linux&#x2F;scripts&#x2F;extract-vmlinux</a></p>
<h2 id="kernel-调试"><a href="#kernel-调试" class="headerlink" title="kernel 调试"></a>kernel 调试</h2><p>主要参考了这个 <a target="_blank" rel="noopener" href="https://kiprey.github.io/2021/10/kernel_pwn_introduction/#4-%E8%B0%83%E8%AF%95%E5%89%8D%E7%9A%84%E5%87%86%E5%A4%87">Kernel pwn CTF 入门 | Kiprey’s Blog</a></p>
<h2 id="断点断不下来"><a href="#断点断不下来" class="headerlink" title="断点断不下来"></a>断点断不下来</h2><p>exp 可以断</p>
<p>原来要加基址</p>
<h2 id="water-ker"><a href="#water-ker" class="headerlink" title="water_ker"></a>water_ker</h2><p><a target="_blank" rel="noopener" href="https://blog.xmcve.com/2023/11/12/%E5%BC%BA%E7%BD%91%E6%8B%9F%E6%80%812023-Writeup/#title-8">强网拟态2023 Writeup - 星盟安全团队</a></p>
<h2 id="打印结构体"><a href="#打印结构体" class="headerlink" title="打印结构体"></a>打印结构体</h2><p><a target="_blank" rel="noopener" href="https://github.com/ocastejon/linux-kernel-learning/blob/main/notes/slab-allocator.md">https://github.com/ocastejon/linux-kernel-learning/blob/main/notes/slab-allocator.md</a></p>
<h2 id="有两个-extern-变量"><a href="#有两个-extern-变量" class="headerlink" title="有两个 extern 变量"></a>有两个 extern 变量</h2><h3 id="kmalloc-caches-NR-KMALLOC-TYPES-KMALLOC-SHIFT-HIGH-1"><a href="#kmalloc-caches-NR-KMALLOC-TYPES-KMALLOC-SHIFT-HIGH-1" class="headerlink" title="kmalloc_caches [NR_KMALLOC_TYPES][KMALLOC_SHIFT_HIGH + 1];"></a><code>kmalloc_caches [NR_KMALLOC_TYPES][KMALLOC_SHIFT_HIGH + 1];</code></h3><p>其中 <code>NR_KMALLOC_TYPES</code> 是类型，<code>KMALLOC_SHIFT_HIGH + 1</code> 表示其大小</p>
<pre><code>pwndbg&gt; p &amp;kmalloc_caches
$22 = (struct kmem_cache *(*)[4][14]) 0xffffffff828512e0
// 有 4 种类型，大小有 14 种
</code></pre>
<p>kmalloc_caches[51] 的地址: </p>
<pre><code>pwndbg&gt; p kmalloc_caches[3][9]
$42 = (struct kmem_cache *) 0xffff888004c44100
</code></pre>
<h3 id="slab-caches"><a href="#slab-caches" class="headerlink" title="slab_caches"></a><code>slab_caches</code></h3><h2 id="slab-cache-的分类"><a href="#slab-cache-的分类" class="headerlink" title="slab cache 的分类"></a>slab cache 的分类</h2><ul>
<li><strong>Dedicated</strong>: They are created by the Linux kernel, and each one is used to hold only given type of a (commonly used) object such as <code>mm_struct</code> or <code>cred_jar</code></li>
<li><strong>Generic</strong>: General purpose caches that can hold any object of a specific size (plus padding). Usually, these caches have objects of sizes of power of two. When calling <code>kmalloc()</code> the, the returned allocated memory will be in one of such caches (like <code>kmalloc-32</code>, <code>kmalloc-64</code>, …) depending on the size requested.</li>
</ul>
<h2 id="kmalloc-trace"><a href="#kmalloc-trace" class="headerlink" title="kmalloc_trace"></a>kmalloc_trace</h2><p><code>kmalloc_trace</code> 函数是一个包装了常规内存分配的追踪和检查功能的工具。它不仅执行常规的内存分配，还记录有关分配的信息，并通过 KASAN 进行额外的错误检测。</p>
<pre><code class="c">void *kmalloc_trace(struct kmem_cache *s, gfp_t gfpflags, size_t size)
&#123;
    void *ret = __kmem_cache_alloc_node(s, gfpflags, NUMA_NO_NODE,
                        size, _RET_IP_);

    trace_kmalloc(_RET_IP_, ret, size, s-&gt;size, gfpflags, NUMA_NO_NODE);

    ret = kasan_kmalloc(s, ret, size, gfpflags);
    return ret;
&#125;
EXPORT_SYMBOL(kmalloc_trace);
</code></pre>
<p>gfpflags 的定义在 gfp_types.h</p>
<p>题目中的 <code>0x400cc0</code> 对应  <code>#define GFP_KERNEL  (__GFP_RECLAIM | __GFP_IO | __GFP_FS)</code> </p>
</div>
</article>

<script src="/js/image_pop_up.js"></script>

	

</body>
</html>